---
session_name: jellyfin
start_directory: ~/

windows:
  - window_name: daemon
    panes:
      - shell_command:
          - jellydot="$DOTFILES/prog/media/jellyfin"
          - cd "$jellydot" || exit 1
          - trap 'cd "$jellydot"; docker-compose --file jellyfin.yml down' EXIT
          # These variables make docker-compose skip trying to mount these directories.
          - |-
            for it in \
                JELLYFIN_SKIP_DOWNLOAD:"$XDG_DOWNLOAD_DIR"    \
                JELLYFIN_SKIP_MUSIC:"$XDG_MUSIC_DIR"          \
                JELLYFIN_SKIP_MOVIES:"$XDG_VIDEOS_DIR/movies" \
                JELLYFIN_SKIP_TV:"$XDG_VIDEOS_DIR/tv"         \
                JELLYFIN_SKIP_MANGA:"$HOME/media/manga"; do
              IFS=: read -r var location <<< "$it"
              [ -e "$location" ] ||
                export "$var"="$XDG_CACHE_HOME/jellyfin.empty"
            done
          - clear && docker-compose --file jellyfin.yml up
